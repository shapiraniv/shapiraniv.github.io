---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import WorkCard from '../../../components/WorkCard.astro';
import { getCollection } from 'astro:content';
import { useTranslations } from '../../../i18n/utils';

export function getStaticPaths() {
  return [
    { params: { lang: 'en' } },
    { params: { lang: 'he' } },
  ];
}

const { lang } = Astro.params as { lang: 'en' | 'he' };
const t = useTranslations(lang);
const isRTL = lang === 'he';

// Get all works and sort by year (newest first)
const allWorks = await getCollection('works');
const sortedWorks = allWorks.sort((a, b) => parseInt(b.data.year) - parseInt(a.data.year));
---

<BaseLayout title={`${t('page.works')} | Niv Shapira`} lang={lang}>
  <div class="page-header row">
    <h2 class:list={{ 'text-end': isRTL, 'ms-auto': isRTL, 'rtl': isRTL }}>
      {t('page.works')}
    </h2>
  </div>
  <div class="row works-table">
    {sortedWorks.map((work) => (
      <WorkCard
        id={work.data.id}
        banner={work.data.banner}
        lang={lang}
      />
    ))}
  </div>
</BaseLayout>
